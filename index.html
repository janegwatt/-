<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>淨力尾牙賓果 - 最終修正版</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bingo-cell { aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; font-weight: 900; border-radius: 8px; transition: all 0.2s; border: 2px solid #e5e7eb; font-size: 1.25rem; }
        .is-marked { background: #ef4444 !important; color: white !important; border-color: #b91c1c !important; }
        .is-drawn { background: #fef3c7; border-color: #fbbf24; color: #d97706; animation: flash 1s infinite; }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function BingoApp() {
            // 1. 玩家姓名狀態
            const [name, setName] = useState('');
            const [isNameSet, setIsNameSet] = useState(false);
            
            // 2. 賓果卡狀態
            const [board, setBoard] = useState([]);
            const [marked, setMarked] = useState(new Set());
            
            // 3. 開獎紀錄狀態
            const [drawInput, setDrawInput] = useState('');
            const [drawHistory, setDrawHistory] = useState([]);

            // 初始化卡片
            useEffect(() => {
                const nums = Array.from({length: 53}, (_, i) => i + 1).sort(() => Math.random() - 0.5).slice(0, 36);
                const grid = [];
                for(let i=0; i<6; i++) grid.push(nums.slice(i*6, (i+1)*6));
                setBoard(grid);
            }, []);

            // 處理標記格子
            const toggleCell = (r, c) => {
                const key = `${r}-${c}`;
                const newMarked = new Set(marked);
                if(newMarked.has(key)) newMarked.delete(key);
                else newMarked.add(key);
                setMarked(newMarked);
            };

            // 處理手動輸入開獎號
            const addDrawNumber = () => {
                const val = parseInt(drawInput);
                if (val > 0 && val <= 53 && !drawHistory.includes(val)) {
                    setDrawHistory([val, ...drawHistory]);
                    setDrawInput('');
                } else {
                    alert("請輸入1-53且未重複的數字");
                }
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white shadow-lg flex flex-col">
                    {/* --- 區域 A: 姓名輸入區 --- */}
                    <div className="p-4 border-b-2 border-red-500 bg-red-50">
                        <label className="block text-xs font-bold text-red-400 mb-1">STEP 1: 玩家姓名</label>
                        <div className="flex gap-2">
                            <input 
                                type="text" 
                                value={name} 
                                onChange={(e) => setName(e.target.value)}
                                disabled={isNameSet}
                                placeholder="請輸入您的名字"
                                className="flex-1 border-2 border-gray-300 p-2 rounded-lg font-bold disabled:bg-gray-200"
                            />
                            {!isNameSet ? (
                                <button onClick={() => name && setIsNameSet(true)} className="bg-red-500 text-white px-4 py-2 rounded-lg font-bold">確認</button>
                            ) : (
                                <button onClick={() => setIsNameSet(false)} className="bg-gray-400 text-white px-4 py-2 rounded-lg font-bold">修改</button>
                            )}
                        </div>
                    </div>

                    {/* --- 區域 B: 手動紀錄區 --- */}
                    <div className="p-4 border-b bg-blue-50">
                        <label className="block text-xs font-bold text-blue-400 mb-1">STEP 2: 紀錄開獎號碼 (現場報號後輸入)</label>
                        <div className="flex gap-2">
                            <input 
                                type="number" 
                                value={drawInput} 
                                onChange={(e) => setDrawInput(e.target.value)}
                                placeholder="輸入數字"
                                className="flex-1 border-2 border-blue-300 p-2 rounded-lg font-bold"
                            />
                            <button onClick={addDrawNumber} className="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold">紀錄號碼</button>
                        </div>
                        <div className="mt-2 flex flex-wrap gap-1">
                            <span className="text-xs font-bold text-gray-400">已開號：</span>
                            {drawHistory.map(n => <span key={n} className="text-xs bg-gray-200 px-2 py-0.5 rounded font-bold text-gray-600">{n}</span>)}
                        </div>
                    </div>

                    {/* --- 區域 C: 賓果卡片區 --- */}
                    <div className="p-4 flex-1">
                        <div className="flex justify-between items-end mb-4">
                            <h2 className="text-xl font-black text-gray-800">{isNameSet ? name : '未命名'} 的卡片</h2>
                            <div className="text-right">
                                <span className="text-xs font-bold text-gray-400 block uppercase">Manual Mode</span>
                                <span className="text-sm font-bold text-red-500">點擊格子變色標記</span>
                            </div>
                        </div>
                        
                        <div className="grid grid-cols-6 gap-2">
                            {board.map((row, rIdx) => row.map((num, cIdx) => {
                                const isMarked = marked.has(`${rIdx}-${cIdx}`);
                                const isDrawn = drawHistory.includes(num);
                                return (
                                    <div 
                                        key={`${rIdx}-${cIdx}`}
                                        onClick={() => toggleCell(rIdx, cIdx)}
                                        className={`bingo-cell cursor-pointer ${isMarked ? 'is-marked' : isDrawn ? 'is-drawn' : 'bg-white'}`}
                                    >
                                        {num}
                                    </div>
                                );
                            }))}
                        </div>
                    </div>

                    <div className="p-4 bg-gray-50 text-[10px] text-gray-400 text-center">
                        淨力尾牙賓果系統 v2.0 - 點擊紅色格子可取消標記
                    </div>
                </div>
            );
        }

        ReactDOM.render(<BingoApp />, document.getElementById('root'));
    </script>
</body>
</html>
